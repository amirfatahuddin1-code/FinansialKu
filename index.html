<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Karsafin - Dashboard Keuangan</title>

    <!-- Dependencies -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;family=Inter:wght@400;500;600&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <script src="assets/lib/chart.min.js"></script>
    <script src="assets/lib/jspdf.umd.min.js"></script>
    <script src="https://app.sandbox.midtrans.com/snap/snap.js"
        data-client-key="SB-Mid-client-oyEZCx5m9JggMLEk"></script>

    <style type="text/tailwindcss">
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-body: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.75);
            --card-border: rgba(255, 255, 255, 0.4);
            --text-main: #1e293b;
            --text-muted: #64748b;
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            --radius-xl: 24px;
            --radius-lg: 16px;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, .brand-name, .nav-text {
            font-family: 'Poppins', sans-serif;
        }
        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            padding: 40px;
            min-height: 100vh;
            line-height: 1.5;
        }
        .container-custom {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
        }
        .brand-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .logo-box {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.25);
        }
        .brand-info h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-dark);
            line-height: 1;
        }
        .brand-info p {
            font-size: 13px;
            color: var(--text-muted);
        }
        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 40px;
            position: relative;
        }
        .search-bar input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border-radius: 16px;
            border: 1px solid transparent;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            outline: none;
            transition: all 0.3s ease;
        }
        .search-bar input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.1);
        }
        .search-bar .material-icons-round {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        .user-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: white;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            transition: transform 0.2s ease;
        }
        .icon-btn:hover {
            transform: translateY(-2px);
        }
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-left: 20px;
            border-left: 1px solid #e2e8f0;
            cursor: pointer; /* Clickable */
        }
        .user-profile img {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        nav.glass-nav {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-xl);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            box-shadow: var(--glass-shadow);
            margin-bottom: 32px;
            overflow-x: auto; /* Responsive */
        }
        .nav-item {
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 24px;
            border-radius: 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-muted);
            border: none; /* Reset button styles */
            background: transparent;
            cursor: pointer;
        }
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.25);
            transform: scale(1.05);
        }
        .nav-item:not(.active):hover {
            background: rgba(255, 255, 255, 0.5);
            color: var(--primary);
        }
        .nav-text {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Functional Styles */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Carousel */
        .carousel-container {
            width: 100%;
            height: 420px;
            border-radius: 32px;
            overflow: hidden;
            position: relative;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .carousel-track {
            display: flex;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.65, 0, 0.35, 1);
        }
        .carousel-slide {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            padding: 0 80px;
            position: relative;
        }
        .slide-1 { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .slide-2 { background: linear-gradient(135deg, #3730a3 0%, #6366f1 100%); }
        .slide-3 { background: linear-gradient(135deg, #5b21b6 0%, #8b5cf6 100%); }
        .slide-content {
            flex: 1;
            color: white;
            z-index: 2;
        }
        .slide-content h2 {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.1;
        }
        .slide-content p {
            font-size: 18px;
            opacity: 0.9;
            max-width: 500px;
            line-height: 1.6;
        }
        .slide-image {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            z-index: 1;
        }
        .slide-image img {
            width: 400px;
            height: 400px;
            object-fit: cover;
            border-radius: 30px;
            transform: rotate(3deg);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 4px solid rgba(255, 255, 255, 0.2);
        }
        .img-placeholder {
            width: 400px; height: 400px; background: rgba(255,255,255,0.2); border-radius: 30px; backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center; font-size: 64px; color: white;
        }
        .carousel-dots {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 3;
        }
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            cursor: pointer;
        }
        .dot.active {
            width: 30px;
            border-radius: 5px;
            background: white;
        }

        /* Dashboard Widgets */
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .period-filter {
            background: white;
            padding: 6px;
            border-radius: 14px;
            display: flex;
            gap: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            border: 1px solid #f1f5f9;
        }
        .filter-btn {
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            background: transparent;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }
        .filter-btn:not(.active):hover {
            background: #f8fafc;
            color: var(--primary);
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 40px;
        }
        .summary-card {
            background: white;
            padding: 24px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.02);
            border: 1px solid #f1f5f9;
            transition: transform 0.3s ease;
        }
        .summary-card:hover { transform: translateY(-5px); }
        .icon-box {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-box.income { background: #ecfdf5; color: var(--secondary); }
        .icon-box.expense { background: #fff1f2; color: var(--danger); }
        .icon-box.balance { background: #eff6ff; color: var(--primary); }
        .summary-info p { font-size: 13px; color: var(--text-muted); margin-bottom: 4px; }
        .summary-info h3 { font-size: 20px; font-weight: 700; color: var(--text-main); }
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        .bottom-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 40px;
        }
        .widget-card {
            background: white;
            border-radius: 28px;
            padding: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
            border: 1px solid #f1f5f9;
            height: 100%;
        }
        .widget-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .widget-title h3 { font-size: 18px; font-weight: 700; }

        /* Legacy App Styles Restored */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal.active { display: flex; }
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px);
        }
        .modal-content {
            position: relative; background: white; border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); max-width: 500px; width: 90%;
            max-height: 90vh; overflow-y: auto; z-index: 1001; padding: 24px;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h3 { font-size: 18px; font-weight: 700; }
        .btn-close { background: none; border: none; cursor: pointer; color: var(--text-muted); }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; }
        .form-group input, .form-group select {
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0;
            background: #f8fafc; outline: none; transition: all 0.2s;
        }
        .form-group input:focus { border-color: var(--primary); background: white; }
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; }
        .category-item {
            display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;
            padding: 12px; border-radius: 12px; border: 1px solid transparent; transition: all 0.2s;
        }
        .category-item:hover { background: #f1f5f9; }
        .category-item.selected { background: #eff6ff; border-color: var(--primary); }
        .category-item .icon { font-size: 24px; background: #e0e7ff; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        
        .toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #1e293b; color: white; padding: 12px 20px; border-radius: 50px; display: flex; align-items: center; gap: 10px; font-size: 13px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .btn-primary { 
            width: 100%; padding: 14px; background: var(--primary); color: white; border: none;
            border-radius: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .transaction-list { display: flex; flex-direction: column; gap: 16px; }
        .transaction-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px; border-radius: 16px; transition: background 0.2s ease; cursor: pointer;
        }
        .transaction-item:hover { background: #f8fafc; }
        .tx-left { display: flex; align-items: center; gap: 12px; }
        .tx-icon {
            width: 48px; height: 48px; border-radius: 12px; background: #f1f5f9;
            display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 20px;
        }
        .tx-info p { font-weight: 600; font-size: 14px; }
        .tx-info span { font-size: 12px; color: var(--text-muted); }
        .tx-amount { font-weight: 700; font-size: 14px; }
        .tx-amount.income { color: var(--secondary); }
        .tx-amount.expense { color: var(--danger); }
        .tx-actions { opacity: 0; transition: opacity 0.2s; }
        .transaction-item:hover .tx-actions { opacity: 1; }

        .fab {
            position: fixed; bottom: 40px; right: 40px; width: 64px; height: 64px;
            border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4); cursor: pointer; border: none; z-index: 100;
            transition: all 0.3s ease;
        }
        .fab:hover { transform: scale(1.1) rotate(90deg); }
        /* FAB Menu */
        #fabMenu { display: none; position: fixed; bottom: 120px; right: 50px; flex-direction: column; gap: 10px; z-index: 99; }
        #fabMenu.active { display: flex; }
        
        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: 1fr 1fr; }
            .bottom-grid { grid-template-columns: 1fr; }
            .summary-grid { grid-template-columns: repeat(2, 1fr); }
            body { padding: 20px; }
        }
    </style>
</head>

<body>
    <div class="container-custom">
        <!-- Header -->
        <header>
            <div class="brand-section">
                <div class="logo-box">
                    <span class="material-icons-round">account_balance_wallet</span>
                </div>
                <div class="brand-info">
                    <h1>Karsafin</h1>
                    <p>Atur Keuangan, Wujudkan Mimpi</p>
                </div>
            </div>
            <div class="search-bar hidden md:block">
                <span class="material-icons-round">search</span>
                <input placeholder="Cari data finansial..." type="text" />
            </div>
            <div class="user-controls">
                <button class="icon-btn"><span class="material-icons-round">notifications</span></button>
                <button class="icon-btn" onclick="document.documentElement.classList.toggle('dark')"><span
                        class="material-icons-round">dark_mode</span></button>
                <div class="user-profile" id="profileTrigger" onclick="openModal('editProfileModal')">
                    <div style="text-align: right; margin-right: 12px;" class="hidden md:block">
                        <p style="font-weight: 600; font-size: 14px;" id="headerProfileName">User</p>
                        <p style="font-size: 12px; color: var(--text-muted);" id="headerProfileEmail">...</p>
                    </div>
                    <img id="headerAvatarImg" alt="Profile"
                        src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff" />
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="glass-nav">
            <button class="nav-item active" data-tab="dashboard">
                <span class="material-icons-round">grid_view</span>
                <span class="nav-text">Dashboard</span>
            </button>
            <button class="nav-item" data-tab="planning">
                <span class="material-icons-round" style="color: #10b981;">account_balance</span>
                <span class="nav-text">Anggaran</span>
            </button>
            <button class="nav-item" data-tab="events">
                <span class="material-icons-round" style="color: #f59e0b;">event</span>
                <span class="nav-text">Acara</span>
            </button>
            <button class="nav-item" data-tab="debts">
                <span class="material-icons-round" style="color: #ef4444;">link_off</span>
                <span class="nav-text">Hutang</span>
            </button>
            <button class="nav-item" data-tab="aiAssistant">
                <span class="material-icons-round" style="color: #6366f1;">psychology</span>
                <span class="nav-text">Asisten AI</span>
            </button>
            <button class="nav-item" data-tab="calculator">
                <span class="material-icons-round" style="color: #3b82f6;">calculate</span>
                <span class="nav-text">Kalkulator</span>
            </button>
            <button class="nav-item" data-tab="reports">
                <span class="material-icons-round" style="color: #8b5cf6;">bar_chart</span>
                <span class="nav-text">Laporan</span>
            </button>
        </nav>

        <!-- DASHBOARD TAB -->
        <section class="tab-content active" id="dashboard">
            <!-- Carousel -->
            <section class="carousel-container">
                <div class="carousel-track">
                    <div class="carousel-slide slide-1">
                        <div class="slide-content">
                            <h2>Atur Keuangan,<br />Wujudkan Mimpi</h2>
                            <p>Satu aplikasi untuk kendali penuh atas masa depan finansial Anda.</p>
                        </div>
                        <div class="slide-image">
                            <!-- Using icon placeholder as image might break or be CORS blocked -->
                            <div class="img-placeholder"><span class="material-icons-round"
                                    style="font-size:120px">savings</span></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Summary -->
            <div class="summary-header">
                <h2 style="font-size: 20px; font-weight: 700;">Ringkasan Finansial</h2>
                <div class="period-filter">
                    <button class="filter-btn period-btn active" data-period="daily">Hari Ini</button>
                    <button class="filter-btn period-btn" data-period="weekly">Minggu Ini</button>
                    <button class="filter-btn period-btn" data-period="monthly">Bulan Ini</button>
                </div>
            </div>

            <div class="summary-grid">
                <div class="summary-card" onclick="openTransactionModal('income')">
                    <div class="icon-box income"><span class="material-icons-round">arrow_upward</span></div>
                    <div class="summary-info">
                        <p>Total Pendapatan</p>
                        <h3 id="totalIncome">Rp 0</h3>
                    </div>
                </div>
                <div class="summary-card" onclick="openTransactionModal('expense')">
                    <div class="icon-box expense"><span class="material-icons-round">arrow_downward</span></div>
                    <div class="summary-info">
                        <p>Total Pengeluaran</p>
                        <h3 id="totalExpense">Rp 0</h3>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon-box balance"><span class="material-icons-round">account_balance</span></div>
                    <div class="summary-info">
                        <p>Saldo Bersih</p>
                        <h3 id="totalBalance">Rp 0</h3>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon-box" style="background: #fdf2f8; color: #db2777;">
                        <span class="material-symbols-outlined">analytics</span>
                    </div>
                    <div class="summary-info">
                        <p>Kesehatan</p>
                        <h3>Baik</h3>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Budget (Donut) -->
                <div class="widget-card">
                    <div class="widget-title">
                        <h3>Alokasi Anggaran</h3>
                        <button class="btn-text" onclick="openModal('budgetModal')">Atur</button>
                    </div>
                    <div class="budget-detailed">
                        <div class="donut-container">
                            <canvas id="budgetDonutChart" width="160" height="160"></canvas>
                            <div class="donut-center">
                                <div class="label">Terpakai</div>
                                <div class="total" id="budgetUsedPercent">0%</div>
                            </div>
                        </div>
                        <div id="budgetCategoriesList" style="max-height: 200px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- Events (Static/Placeholder or Linked) -->
                <div class="widget-card">
                    <div class="widget-title">
                        <h3>Acara Mendatang</h3>
                        <button class="btn-text"
                            onclick="document.querySelector('[data-tab=events]').click()">Lihat</button>
                    </div>
                    <div class="event-list" id="dashboardEventsList">
                        <!-- Injected by JS or empty state -->
                        <div class="empty-state small">
                            <p>Tidak ada acara dekat</p>
                        </div>
                    </div>
                </div>

                <!-- Transactions -->
                <div class="widget-card">
                    <div class="widget-title">
                        <h3>Transaksi Terakhir</h3>
                        <button class="btn-text" id="viewAllTransactions">Semua</button>
                    </div>
                    <div class="transaction-list" id="transactionsList">
                        <!-- Injected by JS -->
                        <p style="text-align:center; padding: 20px;">Memuat...</p>
                    </div>
                </div>
            </div>

            <!-- Bottom Grid (Savings & Debts) -->
            <div class="bottom-grid">
                <div class="widget-card">
                    <div class="widget-title">
                        <h3>Progres Tabungan</h3>
                    </div>
                    <div class="savings-progress-list" id="savingsGoalsList">
                        <!-- Injected by JS -->
                    </div>
                </div>
                <!-- Debt Summary handled by Debts tab usually, but we can put summary here -->
                <div class="widget-card">
                    <div class="widget-title">
                        <h3>Hutang & Piutang</h3>
                    </div>
                    <div class="debt-summary">
                        <div class="debt-box owed">
                            <span class="label">Total Hutang</span>
                            <span class="amount" id="totalDebts">Rp 0</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- OTHER TABS (Wrapped in containers for new theme) -->
        <section class="tab-content" id="planning">
            <div class="widget-card">
                <h2 style="margin-bottom: 20px;">Perencanaan Anggaran</h2>
                <!-- Reuse existing logic injection points -->
                <div id="planningContentPlaceholder">
                    <p>Silakan gunakan dashboard untuk ringkasan. Fitur detail anggaran ada di sini.</p>
                </div>
                <!-- Budget Inputs Container for JS to target if needed, though modal is primary -->
            </div>
        </section>

        <section class="tab-content" id="events">
            <div class="widget-card">
                <div class="widget-title">
                    <h3>Daftar Acara</h3>
                    <button class="btn-primary" style="width: auto;" id="addEventBtn">+ Buat Acara</button>
                </div>
                <div id="eventsList" class="grid grid-cols-1 gap-4"></div>
            </div>
        </section>

        <section class="tab-content" id="debts">
            <div class="widget-card">
                <div class="widget-title">
                    <h3>Catatan Hutang</h3>
                    <button class="btn-primary" style="width: auto;" id="addDebtBtn">+ Catat</button>
                </div>
                <div id="debtsList"></div>
            </div>
        </section>

        <section class="tab-content" id="aiAssistant">
            <div class="widget-card" style="height: 600px; display: flex;">
                <div class="ai-layout" style="width: 100%; height: 100%;">
                    <!-- Chat injected here -->
                    <div id="aiChatMessages" style="flex:1; overflow-y:auto;"></div>
                    <div class="ai-chat-input" style="padding-top: 20px; display: flex; gap: 10px;">
                        <input id="aiChatInput" type="text"
                            style="flex:1; padding: 12px; border-radius: 12px; border: 1px solid #ddd;"
                            placeholder="Tanya AI...">
                        <button id="aiSendBtn" class="btn-primary" style="width: auto;">Kirim</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="tab-content" id="calculator">
            <div class="widget-card">
                <h3>Kalkulator Finansial</h3>
                <!-- Calculator HTML form structure needed for app.js -->
                <div class="flex gap-2 mb-6 overflow-x-auto pb-2 calc-tabs"
                    style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="filter-btn calc-tab active" data-calc="budget">Anggaran</button>
                    <button class="filter-btn calc-tab" data-calc="savings">Tabungan</button>
                </div>

                <div class="calc-content active" id="calc-budget">
                    <div class="form-group">
                        <label>Pendapatan</label>
                        <input type="text" id="calcBudgetIncome" placeholder="10.000.000">
                    </div>
                    <button class="btn-primary" onclick="calculateBudget()">Hitung</button>
                    <div id="budgetResult" style="margin-top: 20px;"></div>
                </div>
            </div>
        </section>

        <section class="tab-content" id="reports">
            <div class="widget-card">
                <h3>Laporan</h3>
                <canvas id="monthlyComparisonChart"></canvas>
            </div>
        </section>

    </div>

    <!-- Floating Action Button -->
    <button class="fab" id="mainFab">
        <span class="material-icons-round" style="font-size: 32px;">add</span>
    </button>
    <div id="fabMenu">
        <button class="fab"
            style="width: 50px; height: 50px; background: #10b981; bottom: auto; right: auto; position: relative;"
            id="fabIncome" title="Pemasukan">
            <span class="material-icons-round">arrow_upward</span>
        </button>
        <button class="fab"
            style="width: 50px; height: 50px; background: #ef4444; bottom: auto; right: auto; position: relative;"
            id="fabExpense" title="Pengeluaran">
            <span class="material-icons-round">arrow_downward</span>
        </button>
    </div>

    <!-- Modals -->
    <div class="modal" id="transactionModal">
        <div class="modal-overlay" onclick="closeModal('transactionModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="transactionModalTitle">Tambah Transaksi</h3>
                <button class="btn-close" onclick="closeModal('transactionModal')"><span
                        class="material-icons-round">close</span></button>
            </div>
            <form id="transactionForm" onsubmit="handleTransactionFormSubmit(event)">
                <input type="hidden" id="transactionId">
                <input type="hidden" id="transactionType" value="expense">
                <div class="form-group">
                    <label>Nominal</label>
                    <input type="text" id="transactionAmount" placeholder="0" oninput="formatAmountInput(this)" required
                        autofocus>
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <div class="category-grid" id="categoryGrid"></div>
                </div>
                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="transactionDate" required>
                </div>
                <div class="form-group">
                    <label>Catatan</label>
                    <input type="text" id="transactionDescription" placeholder="Opsional">
                </div>
                <button type="submit" class="btn-primary">Simpan</button>
            </form>
        </div>
    </div>

    <div class="modal" id="budgetModal">
        <div class="modal-overlay" onclick="closeModal('budgetModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Atur Anggaran</h3>
                <button class="btn-close" onclick="closeModal('budgetModal')">close</button>
            </div>
            <form id="budgetForm" onsubmit="saveBudget(event)">
                <div id="budgetInputs" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;"></div>
                <button type="submit" class="btn-primary">Simpan</button>
            </form>
        </div>
    </div>

    <div class="modal" id="editProfileModal">
        <div class="modal-overlay" onclick="closeModal('editProfileModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Profil</h3><button class="btn-close" onclick="closeModal('editProfileModal')">close</button>
            </div>
            <div class="form-group"><label>Nama</label><input type="text" id="settingsProfileName"></div>
            <button class="btn-primary" id="saveProfileBtn">Simpan</button>
        </div>
    </div>

    <div class="modal" id="subscriptionModal">
        <div class="modal-overlay" onclick="closeModal('subscriptionModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Langganan</h3><button class="btn-close" onclick="closeModal('subscriptionModal')">close</button>
            </div>
            <!-- Content populated by JS -->
            <div class="subscription-status-banner" id="subscriptionStatusBanner"></div>
            <div class="pricing-cards" style="display: grid; gap: 10px;">
                <div class="pricing-card" data-plan="basic"
                    style="border:1px solid #ddd; padding:10px; border-radius:10px;">
                    <h4>Basic</h4>
                    <button class="btn-primary btn-plan" onclick="handleSelectPlan('basic')">Pilih</button>
                </div>
                <div class="pricing-card" data-plan="pro"
                    style="border:1px solid #6366f1; padding:10px; border-radius:10px;">
                    <h4>Pro</h4>
                    <button class="btn-primary btn-plan" onclick="handleSelectPlan('pro')">Pilih</button>
                </div>
            </div>
            <div id="paymentProcessing" style="display:none; text-align:center;">Memproses...</div>
        </div>
    </div>

    <!-- Toasts -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="supabase.js?v=2"></script>
    <script src="app.js?v=3"></script>
</body>

</html>